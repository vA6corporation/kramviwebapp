<section class="container">
    <div class="d-flex">
        <div class="w-100 pr-3">
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Detalles</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <table class="w-100">
                        <tbody>
                            <tr>
                                <td>F. de emision</td>
                                <td align="right">{{ credit?.createdAt | date }}</td>
                            </tr>
                            <tr>
                                <td>M. total</td>
                                <td align="right">{{ (credit?.charge || 0).toFixed(2) }}</td>
                            </tr>
                            <tr class="text-primary">
                                <td>M. pendiente</td>
                                <td align="right">{{ ((credit?.charge || 0) - (credit?.payed || 0)).toFixed(2) }}</td>
                            </tr>
                            <tr class="text-primary">
                                <td>F. de pago</td>
                                <td align="right">{{ credit?.isCredit ? 'CREDITO' : 'CONTADO' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </mat-card-content>
            </mat-card>
            <div class="py-2"></div>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Cliente</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <table class="w-100">
                        <tbody>
                            <tr>
                                <td>Nombres</td>
                                <td align="right">{{ customer?.name }}</td>
                            </tr>
                            <tr>
                                <td>Documento</td>
                                <td align="right">{{ customer?.documentType }}: {{ customer?.document }}</td>
                            </tr>
                            <tr>
                                <td>Celular</td>
                                <td align="right" [ngClass]="{ 'text-muted': !customer?.mobileNumber }">{{
                                    customer?.mobileNumber || 'NINGUNO' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </mat-card-content>
            </mat-card>
            <div class="py-2"></div>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Productos</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <mat-list>
                        <mat-list-item *ngFor="let item of saleItems">
                            <span matListItemTitle>{{ item.fullName }} ({{ item.quantity }})</span>
                            <span class="text-success ml-2" *ngIf="item.igvCode === '11'">Bon</span>
                            <span class="text-primary ml-2" *ngIf="item.igvCode === '20'">Exo</span>
                            <span class="text-primary ml-2" *ngIf="item.igvCode === '30'">Ina</span>
                            <span>{{ (item.price * item.quantity).toFixed(2) }}</span>
                        </mat-list-item>
                    </mat-list>
                </mat-card-content>
            </mat-card>
        </div>
        <div class="w-100 pr-2">
            <mat-card class="mb-4">
                <mat-card-header>
                    <mat-card-title>Pagos</mat-card-title>
                </mat-card-header>
                <mat-list role="list">
                    @for (payment of payments; track payment._id) {
                    <mat-list-item role="listitem" [ngClass]="{ 'bg-danger': payment.deletedAt }">
                        <span matListItemTitle>{{ payment.paymentMethod.name }}</span>
                        <span matListItemLine>{{ payment.createdAt | date }}<span class="divider"></span>{{ payment.observations }}</span>
                        <span matListItemLine>{{ payment.charge.toFixed(2) }}</span>
                        <div matListItemMeta class="h-100 d-flex align-items-center">
                            <button mat-icon-button aria-label="edit" (click)="onEditPayment(payment)">
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button mat-icon-button aria-label="trash"
                                (click)="onDeletePayment(payment._id, payment.saleId)">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </mat-list-item>
                    }
                </mat-list>
                <mat-card-actions>
                    <button mat-flat-button color="primary" (click)="onAddPayment()"
                        [disabled]="turn === null">PAGAR</button>
                </mat-card-actions>
            </mat-card>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Cuotas</mat-card-title>
                </mat-card-header>
                <mat-list>
                    @for (due of dues; track $index) {
                        <mat-list-item>
                            <span matListItemTitle>{{ due.dueDate | date }}</span>
                            <span>{{ due.charge.toFixed(2) }}</span>
                        </mat-list-item>
                    }
                </mat-list>
                <mat-card-actions>
                    <button mat-flat-button color="primary" (click)="onChangeDues()">CUOTAS</button>
                </mat-card-actions>
            </mat-card>
        </div>
    </div>
</section>